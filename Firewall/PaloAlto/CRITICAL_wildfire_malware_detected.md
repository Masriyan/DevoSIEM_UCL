# Palo Alto - WildFire Malware Detection

## Severity
**CRITICAL**

## Description
Detects when Palo Alto WildFire identifies malicious files attempting to enter the network. This indicates active malware delivery attempts that require immediate investigation and containment.

## MITRE ATT&CK
- **Tactic**: Initial Access (TA0001)
- **Technique**: Drive-by Compromise (T1189), Phishing (T1566)

## DEVO Query

```sql
from firewall.paloalto.traffic
select eventdate
select srcaddr
select dstaddr
select srcuser
select dstport
select application
select filename
select filetype
select verdict
select threat_id
select threat_name
select action
select url
select mm2country(srcaddr) as src_country
select mm2country(dstaddr) as dst_country
select purpose(srcaddr) as src_purpose
select purpose(dstaddr) as dst_purpose
where weakhas(threat_type, "wildfire")
  and `in`("malicious", "phishing", verdict)
  and `in`("alert", "block-url", "block-ip", action)
group by srcaddr, dstaddr, threat_name, filename
```

## Alert Configuration
- **Trigger**: Any match
- **Throttling**: 1 alert per srcip per 5 minutes
- **Severity**: Critical
- **Priority**: P1

## Recommended Actions
1. **IMMEDIATE**: Isolate affected host from network
2. Review file hash in threat intelligence platforms
3. Check if file was executed on endpoint (correlate with EDR)
4. Examine user's recent activities for additional IOCs
5. Scan affected system with EDR/antivirus
6. Review email logs if delivery was via email
7. Block file hash and associated URLs/IPs globally

## False Positive Considerations
- Legitimate software flagged incorrectly (rare with WildFire)
- Security testing tools
- Penetration testing activities

**Tuning Recommendations**:
- Whitelist known security tools used by security team
- Document and approve any intentional malware analysis activities

## Enrichment Opportunities
- Correlate with email security logs
- Cross-reference with EDR for execution attempts
- Check historical access patterns for the user
- Verify against threat intelligence feeds

## Response Playbook
1. Verify alert legitimacy
2. Isolate endpoint immediately
3. Capture memory/disk image if needed for forensics
4. Reset user credentials
5. Hunt for lateral movement indicators
6. Update security controls with new IOCs

## Notes
- WildFire verdicts are highly accurate
- Critical severity warrants immediate response
- Consider automated containment workflows
